# 模型集成      
          
了解了CNN网络的基础知识，以及如何训练和验证后。我们已经有一定的能力来训练一个不错的模型，本节将会讲解如何使用集成学习来进一步提高预测精度。

模型集成本身并无太大价值，通常仅在竞赛中使用，这里只做简单介绍。
       
本章讲解的知识点包括：集成学习方法、深度学习中的集成学习。
                  
## 1 学习目标                                      

- 了解集成学习方法以及交叉验证情况下的模型集成       

- 了解深度学习模型的集成学习         
             
## 2 集成学习方法           
             
在机器学习中的集成学习可以在一定程度上提高预测精度，常见的集成学习方法有Stacking、Bagging和Boosting，同时这些集成学习方法与具体验证集划分联系紧密。         
                 
由于深度学习模型一般需要较长的训练周期，如果硬件设备不允许建议选取留出法，如果需要追求精度可以使用交叉验证的方法。             
              
下面假设构建了10折交叉验证，训练得到10个CNN模型。           

![IMG](../../../markdown_imgs/chapter02/2.4/交叉验证.png)      
       
那么在10个CNN模型可以对模型进行集成，一种最简单且常用的做法就是投票，即等权重的求和取平均
      
## 3 深度学习中的集成学习          
               
此外在深度学习中本身还有一些集成学习思路的做法，值得借鉴学习：
              
#### 3.1 Dropout                

Dropout可以作为训练深度神经网络的一种技巧。在每个训练批次中，通过随机让一部分的节点停止工作。同时在预测的过程中让所有的节点都其作用。       

![IMG](../../../markdown_imgs/chapter02/2.4/Droopout.png)      
             
Dropout经常出现在后接全连接层的CNN网络中，可以有效的缓解模型过拟合的情况，也可以在预测时增加模型的精度。        

不过现在随着BN以及全卷积网络的广泛使用，dropout已经不经常使用了。
                  
#### 3.2 TTA        

测试集数据扩增（Test Time Augmentation，简称TTA）也是常用的集成学习技巧，数据扩增不仅可以在训练时候用，而且可以同样在预测时候进行数据扩增。

对同一个样本预测多次，然后对多次结果进行平均，同样能带来准确率的提升。  

|1|2|3|      
|----|-----|------|                      
|![IMG](../../../markdown_imgs/chapter02/2.4/23.png) | ![IMG](../../../markdown_imgs/chapter02/2.4/23_1.png)| ![IMG](../../../markdown_imgs/chapter02/2.4/23_2.png)|   
             
#### 3.3 Snapshot               
                
本章的开头已经提到，假设我们训练了10个CNN则可以将多个模型的预测结果进行平均。

但是假如只训练了一个CNN模型，如何做模型集成呢？          
                   
在论文Snapshot Ensembles中，作者提出使用cyclical learning rate进行训练模型，并保存精度比较好的一些checkopint，最后将多个checkpoint进行模型集成。       

![IMG](../../../markdown_imgs/chapter02/2.4/Snapshot.png)     
          
由于在cyclical learning rate中学习率的变化有周期性变大和减少的行为，因此CNN模型很有可能在跳出局部最优进入另一个局部最优。在Snapshot论文中作者通过使用表明，此种方法可以在一定程度上提高模型精度，但需要更长的训练时间。    

 ![IMG](../../../markdown_imgs/chapter02/2.4/对比.png)     
            
## 4 本章小节 
                  
在本章中我们简单介绍了深度学习模型做集成学习的各种方法，供了解和学习。

但是这类方法并不推荐，并且以下几点需要大家注意：     
      
- 集成学习只能在一定程度上提高精度，并需要耗费较大的训练时间，因此建议先使用提高单个模型的精度，再考虑集成学习过程；

- 具体的集成学习方法需要与验证集划分方法结合，TTA在几乎所有场景都可以起作用。


---

--- ***By: 阿水***

>微信公众号：Coggle数据科学

--- ***By: 安晟***

>一只普通的算法攻城狮，邮箱[anshengmath@163.com]，[CSDN博客](https://blog.csdn.net/u011583927)，[Github](https://github.com/monkeyDemon)


**关于Datawhale**：

>Datawhale是一个专注于数据科学与AI领域的开源组织，汇集了众多领域院校和知名企业的优秀学习者，聚合了一群有开源精神和探索精神的团队成员。Datawhale以“for the learner，和学习者一起成长”为愿景，鼓励真实地展现自我、开放包容、互信互助、敢于试错和勇于担当。同时Datawhale 用开源的理念去探索开源内容、开源学习和开源方案，赋能人才培养，助力人才成长，建立起人与人，人与知识，人与企业和人与未来的联结。

